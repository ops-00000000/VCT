# Система распознавания и классификации транспортных средств на видео

## Обзор проекта

Эта система предназначена для обнаружения и классификации транспортных средств на видео с использованием гибридного подхода, объединяющего YOLO (You Only Look Once) и специализированный классификатор на основе EfficientNet. Система с высокой точностью идентифицирует различные типы транспортных средств, включая автомобили, грузовики, мотоциклы, велосипеды и автобусы.

## Ключевые особенности

- **Гибридная архитектура**: Сочетание YOLOv8 для обнаружения объектов и нашего специализированного классификатора на базе EfficientNet-B0 для уточнения типа транспортного средства
- **Оптимизированная обработка**: Эффективная обработка кадров с возможностью управления шагом пропуска кадров для ускорения работы
- **Визуализация результатов**: Генерация детальной статистики и визуализаций по распределению классов
- **Высокая точность**: Подтвержденный уровень согласия между YOLO и нашим классификатором - 96.2%

## Архитектура системы

### 1. Модуль обнаружения объектов (YOLOv8)

Система использует предварительно обученную модель YOLOv8n для первичного обнаружения объектов на видео. YOLOv8 идентифицирует все объекты в кадре и применяет фильтрацию, чтобы выделить только транспортные средства: автомобили, грузовики, мотоциклы, велосипеды и автобусы.

### 2. Модуль классификации (наш классификатор на базе EfficientNet-B0)

После обнаружения объектов системой YOLO, наш специализированный классификатор на базе EfficientNet-B0 производит более точную классификацию обнаруженных транспортных средств. Эта модель не используется как готовая - мы самостоятельно обучили её на специально подготовленном наборе данных, содержащем четыре класса: велосипеды, автобусы, автомобили и мотоциклы.

Особенности нашего классификатора:
- В качестве базовой архитектуры используется EfficientNet-B0 (оптимальная по соотношению точности и вычислительной сложности)
- Начальные веса взяты из предобученной на ImageNet модели, но затем полностью адаптированы под нашу задачу
- Применена заморозка ранних слоев для ускорения обучения и предотвращения переобучения
- Реализована расширенная аугментация данных для улучшения обобщающей способности

### 3. Гибридный подход обработки

Одной из ключевых особенностей системы является гибридный подход к классификации:
- **Для грузовиков**: сохраняется оригинальная классификация YOLO без переклассификации
- **Для других транспортных средств**: выполняется уточнение типа с помощью нашего классификатора

Этот подход позволяет использовать сильные стороны обеих моделей, повышая общую точность системы.

## Технические компоненты

### Основные файлы системы

1. **vehicle_classifier_model.py**: 
   - Содержит определение и код обучения нашей модели классификатора на базе EfficientNet-B0
   - Включает класс датасета для обработки данных в формате YOLO
   - Реализует функции обучения и оценки модели

2. **yolo_processor.py**: 
   - Основной скрипт для обработки видео
   - Интегрирует YOLOv8 и наш обученный классификатор
   - Выполняет обнаружение, классификацию и визуализацию результатов
   - Генерирует статистику и графики распределения классов

### Используемые технологии

- **PyTorch**: Основной фреймворк для моделей глубокого обучения
- **Ultralytics YOLOv8**: Версия алгоритма обнаружения объектов
- **OpenCV**: Обработка видео и визуализация результатов
- **Matplotlib/Seaborn**: Генерация графиков и визуализаций
- **Pillow (PIL)**: Обработка изображений
- **NumPy**: Эффективные операции с массивами данных

## Процесс работы системы

### 1. Обучение классификатора

Наш классификатор транспортных средств обучается следующим образом:

1. **Подготовка данных**:
   - Извлечение объектов из датасета в формате YOLO
   - Применение аугментаций для улучшения разнообразия данных
   - Разделение на тренировочную, валидационную и тестовую выборки

2. **Обучение модели**:
   - Загрузка базовой архитектуры EfficientNet-B0 с предобученными на ImageNet весами
   - Заморозка ранних слоев сети
   - Замена последнего слоя классификации на новый для наших четырех классов
   - Обучение с использованием Adam-оптимизатора и схемы снижения скорости обучения
   - Раннее останавливание для предотвращения переобучения
   - Сохранение лучшей модели по метрике точности на валидационной выборке

3. **Оценка модели**:
   - Подсчет общей точности и точности по классам
   - Построение матрицы ошибок
   - Визуализация процесса обучения (графики потерь и точности)

### 2. Обработка видео

Процесс обработки видео включает следующие шаги:

1. **Инициализация моделей**:
   - Загрузка предобученной модели YOLOv8
   - Загрузка нашего обученного классификатора транспортных средств

2. **Обработка кадров**:
   - Чтение кадров из видеофайла с заданным шагом
   - Масштабирование кадров для оптимизации производительности
   - Применение YOLOv8 для обнаружения объектов на кадре

3. **Классификация объектов**:
   - Фильтрация обнаруженных объектов по классам транспортных средств
   - Для грузовиков: сохранение оригинальной классификации YOLO
   - Для других транспортных средств: применение нашего специализированного классификатора
   - Применение пороговых значений уверенности для минимизации ошибок

4. **Визуализация и сохранение**:
   - Отрисовка ограничивающих рамок вокруг обнаруженных объектов
   - Аннотирование объектов метками класса и процентом уверенности
   - Добавление счетчиков обнаруженных классов на кадре
   - Сохранение обработанного видео

5. **Генерация статистики**:
   - Подсчет общего количества обнаруженных объектов
   - Анализ распределения по классам
   - Построение графиков распределения классов
   - Сохранение статистики в CSV-файл

## Результаты работы

В результате обработки тестового видео (900 кадров с шагом 2) были получены следующие результаты:

- **Общее количество обнаруженных объектов**: 14440
- **Уровень согласия** между YOLO и нашим классификатором: 96.2%
- **Распределение классов**:
  - Автомобили (car): 92.1%
  - Грузовики (truck): 6.2%
  - Мотоциклы (motorbike): 1.7%
  - Автобусы (bus): <0.1%
  - Велосипеды (bicycle): 0%

## Запуск системы

### Предварительные требования

- Python 3.8 или выше
- PyTorch 1.8 или выше
- Ultralytics YOLOv8
- OpenCV-Python
- Matplotlib
- NumPy
- Pillow

### Установка зависимостей

```bash
pip install torch torchvision ultralytics opencv-python matplotlib numpy pillow
```

### Запуск обработки видео

```bash
python yolo_processor.py
```

По умолчанию скрипт обрабатывает видео из файла `results/2103099-uhd_3840_2160_30fps.mp4` и сохраняет результат в `results/full_yolo_processed_video.mp4`.


## Заключение

Разработанная система распознавания и классификации транспортных средств демонстрирует эффективность гибридного подхода, объединяющего современные методы глубокого обучения. Высокий уровень согласия между моделями (96.2%) и точное распределение по классам подтверждают надежность системы для задач анализа трафика и мониторинга дорожного движения.

Гибкая архитектура системы позволяет адаптировать ее для различных сценариев применения, от анализа городского трафика до систем безопасности и автоматизированного контроля транспортных потоков. 
